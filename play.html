<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playfair Cipher</title>
  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 60px;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
    }
    .flex {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .box {
      flex: 1;
      background: white;
      padding: 15px;
      box-shadow: 0 0 10px #ccc;
    }
  </style>
</head>
<body>
  <h2>Playfair Cipher</h2>
  <label>Enter Key (e.g., MONARCHY):</label>
  <input type="text" id="key" placeholder="Enter key" />

  <div class="flex">
    <div class="box">
      <h3>Encrypt</h3>
      <label>Plaintext:</label>
      <textarea id="plain"></textarea>
      <button onclick="encryptPlayfair()">Encrypt</button>
      <label>Ciphertext:</label>
      <textarea id="encrypted" readonly></textarea>
    </div>

    <div class="box">
      <h3>Decrypt</h3>
      <label>Ciphertext:</label>
      <textarea id="cipher"></textarea>
      <button onclick="decryptPlayfair()">Decrypt</button>
      <label>Plaintext:</label>
      <textarea id="decrypted" readonly></textarea>
    </div>
  </div>

  <script>
    function generateMatrix(key) {
      key = key.toUpperCase().replace(/J/g, 'I').replace(/[^A-Z]/g, '');
      let seen = new Set();
      let matrix = [];
      for (let char of key + 'ABCDEFGHIKLMNOPQRSTUVWXYZ') {
        if (!seen.has(char)) {
          seen.add(char);
          matrix.push(char);
        }
      }
      return matrix;
    }

    function prepareText(text, forEncryption = true) {
      text = text.toUpperCase().replace(/J/g, 'I').replace(/[^A-Z]/g, '');
      let prepared = '';
      for (let i = 0; i < text.length; i += 2) {
        let a = text[i];
        let b = text[i + 1];
        if (!b || a === b) {
          b = 'X';
          i--; // step back one character to re-check
        }
        prepared += a + b;
      }
      return prepared;
    }

    function getPosition(matrix, char) {
      let idx = matrix.indexOf(char);
      return [Math.floor(idx / 5), idx % 5];
    }

    function processDigraphs(text, matrix, mode) {
      let result = '';
      for (let i = 0; i < text.length; i += 2) {
        let [a, b] = [text[i], text[i + 1]];
        let [r1, c1] = getPosition(matrix, a);
        let [r2, c2] = getPosition(matrix, b);

        if (r1 === r2) {
          // same row
          c1 = (c1 + (mode === 'encrypt' ? 1 : 4)) % 5;
          c2 = (c2 + (mode === 'encrypt' ? 1 : 4)) % 5;
        } else if (c1 === c2) {
          // same column
          r1 = (r1 + (mode === 'encrypt' ? 1 : 4)) % 5;
          r2 = (r2 + (mode === 'encrypt' ? 1 : 4)) % 5;
        } else {
          // rectangle swap
          [c1, c2] = [c2, c1];
        }

        result += matrix[r1 * 5 + c1] + matrix[r2 * 5 + c2];
      }
      return result;
    }

    function encryptPlayfair() {
      const key = document.getElementById('key').value;
      const plaintext = document.getElementById('plain').value;
      const matrix = generateMatrix(key);
      const prepared = prepareText(plaintext);
      const encrypted = processDigraphs(prepared, matrix, 'encrypt');
      document.getElementById('encrypted').value = encrypted;
    }

    function decryptPlayfair() {
      const key = document.getElementById('key').value;
      const ciphertext = document.getElementById('cipher').value;
      const matrix = generateMatrix(key);
      const decrypted = processDigraphs(ciphertext.toUpperCase().replace(/[^A-Z]/g, ''), matrix, 'decrypt');
      document.getElementById('decrypted').value = decrypted;
    }
  </script>
</body>
</html>
